# üîß **–û—Ç–ª–∞–¥–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ P.I.D.R. Game**

## üö® **–¢–µ–∫—É—â–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:**
1. ‚ùå –°—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—Ö–æ–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –±–µ–ª—ã–π —Ñ–æ–Ω –≤–º–µ—Å—Ç–æ —Ç–µ–º–Ω–æ–≥–æ
2. ‚ùå 500 –æ—à–∏–±–∫–∞ –ø—Ä–∏ POST `/api/auth` 
3. ‚ùå "–û—à–∏–±–∫–∞ —Å–µ—Ç–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ"
4. ‚ùå Telegram –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

## üõ†Ô∏è **–†–µ—à–µ–Ω–∏—è:**

### **1. –¢–µ—Å—Ç–æ–≤–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è**
–°–æ–∑–¥–∞–Ω–∞ —Ç–µ—Å—Ç–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞: `/auth/test-login`

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- ‚úÖ –û–±—Ö–æ–¥–∏—Ç Supabase (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç `/api/auth/test`)
- ‚úÖ –°–∏–º—É–ª–∏—Ä—É–µ—Ç Telegram –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
- ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ localStorage
- ‚úÖ –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –≤ –∏–≥—Ä—É

**–ö–∞–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ `/auth/test-login`
2. –ù–∞–∂–º–∏—Ç–µ "–¢–ï–°–¢ TELEGRAM –í–•–û–î"
3. –î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å "‚úÖ –£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥!"
4. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –≥–ª–∞–≤–Ω—É—é

### **2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ —Å–µ—Ä–≤–µ—Ä–∞**
–î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `/api/auth`:

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ dev —Å–µ—Ä–≤–µ—Ä –∏ —Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏:
npm run dev

# –í –∫–æ–Ω—Å–æ–ª–∏ –±—É–¥—É—Ç –ª–æ–≥–∏:
üöÄ Auth API called
üìù Request body: {...}
üì± Telegram auth request
üë§ Telegram user data: {...}
üîç Looking for user with telegramId: ...
```

### **3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è**

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env.local` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:

```env
# Supabase (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ!)
SUPABASE_URL=https://your-project-id.supabase.co
SUPABASE_ANON_KEY=your-anon-key

# JWT (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ!)
JWT_SECRET=your-very-long-secret-key-here

# Telegram (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –¥–ª—è —Ç–µ—Å—Ç–∞)
BOT_TOKEN=your-telegram-bot-token

# Rate limiting (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
UPSTASH_REDIS_REST_URL=your-redis-url
UPSTASH_REDIS_REST_TOKEN=your-redis-token
```

### **4. –ü—Ä–æ–≤–µ—Ä–∫–∞ Supabase**

#### **–°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã users:**
```sql
-- –í Supabase SQL Editor –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
CREATE TABLE IF NOT EXISTS users (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  telegramId VARCHAR(50) UNIQUE,
  username VARCHAR(50) UNIQUE NOT NULL,
  firstName VARCHAR(100),
  lastName VARCHAR(100),
  avatar VARCHAR(500),
  authType VARCHAR(20) DEFAULT 'local',
  gamesPlayed INTEGER DEFAULT 0,
  gamesWon INTEGER DEFAULT 0,
  rating INTEGER DEFAULT 1000,
  coins INTEGER DEFAULT 1000,
  referralCode VARCHAR(10) UNIQUE,
  registrationDate TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  createdAt TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updatedAt TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- –ò–Ω–¥–µ–∫—Å—ã
CREATE INDEX IF NOT EXISTS idx_users_telegram_id ON users(telegramId);
CREATE INDEX IF NOT EXISTS idx_users_username ON users(username);

-- –¢–∞–±–ª–∏—Ü–∞ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
CREATE TABLE IF NOT EXISTS user_status (
  user_id UUID REFERENCES users(id) ON DELETE CASCADE PRIMARY KEY,
  status VARCHAR(20) DEFAULT 'offline',
  last_seen TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

### **5. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∏–∑–∞–π–Ω–∞**

–ï—Å–ª–∏ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—Ö–æ–¥–∞ –≤—Å–µ –µ—â–µ –±–µ–ª–∞—è:

1. **–û—á–∏—Å—Ç–∏—Ç–µ –∫—ç—à –±—Ä–∞—É–∑–µ—Ä–∞:**
   - Ctrl+Shift+R (–∂–µ—Å—Ç–∫–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞)
   - –ò–ª–∏ –æ—Ç–∫—Ä–æ–π—Ç–µ –≤ –ø—Ä–∏–≤–∞—Ç–Ω–æ–º —Ä–µ–∂–∏–º–µ

2. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ dev —Å–µ—Ä–≤–µ—Ä:**
   ```bash
   # –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä (Ctrl+C)
   npm run dev
   ```

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–π–ª `src/app/auth/login/page.tsx`:**
   - –î–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å `bg="linear-gradient(135deg, #0f172a..."`
   - –ù–µ –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å `bg="white"`

## üîç **–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —à–∞–≥ –∑–∞ —à–∞–≥–æ–º:**

### **–®–∞–≥ 1: –¢–µ—Å—Ç–æ–≤—ã–π API**
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Ç–µ—Å—Ç–æ–≤—ã–π API —Ä–∞–±–æ—Ç–∞–µ—Ç:
curl http://localhost:3000/api/auth/test
# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å: {"status":"Test auth API is working",...}
```

### **–®–∞–≥ 2: –¢–µ—Å—Ç–æ–≤–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è**
1. –û—Ç–∫—Ä–æ–π—Ç–µ `/auth/test-login`
2. –û—Ç–∫—Ä–æ–π—Ç–µ DevTools (F12) ‚Üí Console
3. –ù–∞–∂–º–∏—Ç–µ "–¢–ï–°–¢ TELEGRAM –í–•–û–î"
4. –°–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ –∏ —Å–µ—Ä–≤–µ—Ä–∞

### **–®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ Supabase**
```bash
# –í –∫–æ–Ω—Å–æ–ª–∏ —Å–µ—Ä–≤–µ—Ä–∞ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
# ‚úÖ Supabase config check: { hasUrl: true, hasKey: true, ... }
# ‚ùå –ï—Å–ª–∏: Missing Supabase environment variables
```

### **–®–∞–≥ 4: –†–µ–∞–ª—å–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è**
–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞:
1. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
2. –°–æ–∑–¥–∞–π—Ç–µ —Ç–∞–±–ª–∏—Ü—ã –≤ Supabase
3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±—ã—á–Ω—ã–π –≤—Ö–æ–¥ `/auth/login`

## üéØ **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**

### **–í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:**
1. ‚úÖ **–¢–µ—Å—Ç–æ–≤–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è** (–≥–æ—Ç–æ–≤–∞)
2. üîß **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è** (–Ω–∞—Å—Ç—Ä–æ–π—Ç–µ)
3. üîß **Supabase —Ç–∞–±–ª–∏—Ü—ã** (—Å–æ–∑–¥–∞–π—Ç–µ)

### **–°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:**
4. üîß **–î–∏–∑–∞–π–Ω —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤—Ö–æ–¥–∞** (–æ—á–∏—Å—Ç–∏—Ç–µ –∫—ç—à)
5. üîß **Telegram bot –Ω–∞—Å—Ç—Ä–æ–π–∫–∞**

### **–ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:**
6. üîß **Rate limiting** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
7. üîß **OAuth –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã** (Google, VK)

## üöÄ **–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –¥–ª—è —Ç–µ—Å—Ç–∞:**

1. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä:**
   ```bash
   npm run dev
   ```

2. **–û—Ç–∫—Ä–æ–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É:**
   ```
   http://localhost:3000/auth/test-login
   ```

3. **–ù–∞–∂–º–∏—Ç–µ "–¢–ï–°–¢ TELEGRAM –í–•–û–î"**

4. **–ï—Å–ª–∏ —É—Å–ø–µ—à–Ω–æ - —É–≤–∏–¥–∏—Ç–µ:**
   - ‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ localStorage

5. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ localStorage:**
   - F12 ‚Üí Application ‚Üí Local Storage
   - –î–æ–ª–∂–Ω—ã –±—ã—Ç—å: `auth_token`, `user`, `current_user`

## üìû **–ï—Å–ª–∏ –≤—Å–µ –µ—â–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:**

### **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—Ä—Ç:**
- –°–µ—Ä–≤–µ—Ä –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∞ `http://localhost:3000`
- –ù–µ `http://localhost:3001` –∏–ª–∏ –¥—Ä—É–≥–æ–º –ø–æ—Ä—Ç—É

### **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–π–ª—ã:**
- `src/app/api/auth/test/route.ts` - –¥–æ–ª–∂–µ–Ω —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å
- `src/app/auth/test-login/page.tsx` - –¥–æ–ª–∂–µ–Ω —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å

### **–õ–æ–≥–∏ –æ—à–∏–±–æ–∫:**
```bash
# –í —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –≥–¥–µ –∑–∞–ø—É—â–µ–Ω npm run dev —Å–º–æ—Ç—Ä–∏—Ç–µ:
üöÄ Auth API called          # API –≤—ã–∑–≤–∞–ª—Å—è
üìù Request body: {...}      # –î–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–µ–Ω—ã
‚úÖ Test user created: {...} # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–Ω

# –ï—Å–ª–∏ –Ω–µ—Ç —ç—Ç–∏—Ö –ª–æ–≥–æ–≤ - –ø—Ä–æ–±–ª–µ–º–∞ —Å –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–µ–π
```

---

**–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞ –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π Supabase!** üéâ
